---
title: "STRETCH - Northern Latitudes Draft MS Figures"
subtitle: "`r Sys.Date()` <br> D Briscoe"
author: ""
date: ""
format:
  html:
    theme: flatly
    fontsize: 20px
    toc: true
    toc-expand: true	
    number-sections: false
    toc-location: left
    number-depth: 2
    smooth-scroll: true
    fig-cap-location: top
filters:
  - lightbox
lightbox: 
  match: auto
  effect: zoom
  desc-position: top
---


```{=html}
<style>
.main-container {
    max-width: 1600px !important;
    margin-left: 0;
    margin-right: 1;
}

#quarto-document-content {
  width: 950px;
}

</style>

<style type="text/css">
  body{
  font-size: 12.5pt;
}

h1, .title, .subtitle {
    <!-- font-family: Arial, sans-serif; -->
    <!-- font-weight: 700; -->
    color: black;
}

h2, h3 {
  color: #447099;
  font-weight: 500;
}
</style>

```

```{r 00-setup, include=FALSE}
knitr::opts_chunk$set(
    echo = FALSE,
    eval = TRUE,
    message = FALSE,
    warning = FALSE,
    dpi = 300,
    fig.align = "center"
    )

# See Options: knitr::opts_chunk$get()
```


<br>


### Fig 1 \| Average Turtle Latitude by Week

<br>

[Main figure is shown in the first tab: **July-Sept**]{style="font-size: 15pt"} 

<br>

[Second figure is fyi to show how 2023 turtles are closing the gap and are now tracking much closer to historic lats since mid-Oct/Nov]{style="font-size: 15pt"}

<br>

::: {.panel-tabset}
#### July-Sept
![](images/draft_fig1_plot_avg_turtle_lats_by_week_july_sept.png)

#### July-Nov (extra)
![](images/draft_fig1_plot_avg_turtle_lats_by_week_july_nov.png)
:::



### Fig 2 \| Turtle-Env Histograms


[September & March SSTs for Historic (1997 - 2012) vs 'Cohort 1' (2023)]{style="font-size: 18pt"}


```{r load-obsdata-178W-140!}
library(tidyverse)
library(knitr)
library(kableExtra)
obsdata <- readRDS(file = "../data/processed/xtracted_cc_sept_mar_178W_140W_1997_2023.rds")

```

```{r func-get-sst-stats}

get_n_turtles_yr <- function(df, lons){
    
    lons <- lons
    tmp <- 
        df %>%
        filter(month == 9) %>% 
        filter(lon >= lons[1] & lon <= lons[2])

    yr_sst_mean <- tmp %>%
        group_by(year) %>%
        summarise(mean = mean(sst_dhw_5km_new_mean, na.rm=T))


    ret <- tmp %>%
        group_by(year) %>%
        summarize(count=n_distinct(id)) %>%
        spread(year, count) %>%
         as.data.frame() 

    row.names(ret) <- c("n Turtles")

    print(ret, include.rownames = T)
    
}

get_n_unique <- function(df, lons){
    ret <- df %>%
        filter(month == 9) %>% 
        filter(lon >= lons[1] & lon <= lons[2]) %>%
        group_by(group) %>%
        summarize(count=n_distinct(id)) %>%
        spread(group, count) 
    return(ret)
}

get_summary_stats <- function(df, lons){
    ret <- df %>%
        filter(month == 9 | month == 3) %>% 
        filter(lon >= lons[1] & lon <= lons[2]) %>%
        group_by(group, month) %>%
        summarize(sst_mean = round(mean(sst_dhw_5km_new_mean),2),
                  chl_mean = round(mean(chl_mean, na.rm=T),2)) %>%
         mutate(month = month.abb[month],
                group = str_to_title(group)) %>%
        arrange(month) %>%
        arrange(desc(group)) %>%
        as.data.frame()
    colnames(ret) <- c("Group  ", "Month","Mean SST (°C)", "Mean Chla (mg/m3)")
    return(ret)
}
    
```

<br>

##### **A) Longitude: 178°W to 140°W** (n = 65 unique turtles)

<br>

```{r results=FALSE}
get_n_unique(df = obsdata, lons = c(-178, -140))$historic 
```


```{r get-n-by-lon-178W}

get_n_turtles_yr(df = obsdata, lons = c(-178, -140))

```

```{r get-sum-stats-178W}

get_summary_stats(df = obsdata, lons = c(-178, -140))

```

<br>

::: {.panel-tabset}

#### Sept (SST by Group) 
![](images/plot_facet_Sep_sst_histogram_by_group_178W_140W.png)

#### Sept (SST by Year)
![](images/plot_facet_Sep_sst_histogram_by_yr_178W_140W.png)

#### Sept (Chl by Group) 
![](images/plot_facet_Sep_chl_histogram_by_group_178W_140W.png)

#### Sept (Chl by Year)
![](images/plot_facet_Sep_chl_histogram_by_yr_178W_140W.png)

:::

<br>

#### **B) Longitude: 170°W to 140°W** (n unique turtles = 43)

<br>

```{r results=FALSE}
get_n_unique(df = obsdata, lons = c(-170, -140))$historic 
```

```{r subet-by-lon-170W}

get_n_turtles_yr(df = obsdata, lons = c(-170, -140))

```

```{r get-sum-stats-170W}

get_summary_stats(df = obsdata, lons = c(-170, -140))

```

<br>

::: {.panel-tabset}

#### Sept (SST by Group) 
![](images/plot_facet_Sep_sst_histogram_by_group_170W_140W.png)


#### Sept (SST by Year) 
![](images/plot_facet_Sep_sst_histogram_by_yr_170W_140W.png)

#### Sept (Chl by Group) 
![](images/plot_facet_Sep_chl_histogram_by_group_170W_140W.png)

#### Sept (Chl by Year) 
![](images/plot_facet_Sep_chl_histogram_by_yr_170W_140W.png)

:::


<br>

##### **C) Longitude: 165°W to 140°W** (n unique turtles = 32)

<br>

```{r results=FALSE}
get_n_unique(df = obsdata, lons = c(-165, -140))$historic 
```

```{r get-n-by-lon-165W}

get_n_turtles_yr(df = obsdata, lons = c(-165, -140))

```

```{r get-sum-stats-165W}

get_summary_stats(df = obsdata, lons = c(-165, -140))

```

<br>

::: {.panel-tabset}


```{r subet-by-lon-165W}

get_n_turtles_yr(df = obsdata, lons = c(-165, -140))

```


#### Sept (SST by Group) 
![](images/plot_facet_Sep_sst_histogram_by_group_165W_140W.png)

#### Sept (SST by Year) 
![](images/plot_facet_Sep_sst_histogram_by_yr_165W_140W.png)

#### Sept (Chl by Group) 
![](images/plot_facet_Sep_chl_histogram_by_group_165W_140W.png)

#### Sept (Chl by Year) 
![](images/plot_facet_Sep_chl_histogram_by_yr_165W_140W.png)

:::

<br>

### Fig 3 \| September Turtle & 18°C Isotherm Position

<br>

::: columns
::: {.column width="5%"}
[text]{style="color:transparent"}
:::

::: {.column width="95%"}
<span style="font-size:16pt">
Average SST Isotherm Location:<br>
[**2006 - 2007 18°C (light purple)**]{style="color:#9D4EDD"} <br>
[**19.5°C (dark purple)**]{style="color:#3C096C"} <br>
[**2023 18°C (light green)**]{style="color:#69b3a2"} <br>
[**2023 19.5°C (dark green)**]{style="color:#2D6D5E"}

</span>
:::
:::

![](images/draft_fig3_plot_avg_cc_and_18C_195C_isotherms_sept_by_enso.png)



### Fig 4 \| September & March GAMs

<br>

[**Model: Latitude of 18°C isotherm (Mar or Sept) \~ Year**]{style="font-size: 16pt"}


![March](images/gam_partial_plot_Mar_18C.png)

![Sept](images/gam_partial_plot_Sept_18C.png)

![Difference September - Mar 18°C Isotherm Position (Placeholder)](images/draft_fig4x_plot_mean_18deg_lat_by_year_diff_sept_mar_lm.png)


### Fig 5 \| Longterm Seasonal 18°C Isotherm Position

<br>

::: columns
::: {.column width="8%"}
[text]{style="color:transparent"}
:::

::: {.column width="92%"}
<span style="font-size:14pt">
**Black Line: 2020 - 2023 Average** <br>
[**Light Gray Line: 1990 - 1993 Average**]{style="color:#ADB5BD"} <br>
</span>
:::
:::

![](images/draft_fig5_plot_18C_isotherm_longterm_sept_mar.png)




## Additional Figures 

### Fig | Average Seasonal Position of 18°C (March/Sept) between 1985 - 2023

<br>

[*Placeholder figure: * Not sure this works because if Sept 1997 is given an El Nino value, then March 1997 is also given the El Nino value -- when it should be March 1998.]{style="font-size: 16pt"} 

<br>

![](images/plot_mar_sept_avg_lats_no_turtles_18C_enso_conds.png)
<br>
<br>

### Fig | Monthly 18C SST Isotherm Position by ENSO Year

<br>

![](images/plot_tzcf_enso_yrs.png)

<br>
<br>

### Fig | Annual SST Anomaly & 18°C Isotherm Position in the NE Pacific, by ENSO 

<br>

[Location of 18°C isotherm based on the September preceding an ENSO event <br> (ie Sept 1997 = 'El Nino' Sept)  *-- or-- * year of a marine heatwave (MHW, ie Sept 2015 = 'MHW')]{style="font-size: 16pt"}

<span style="font-size:16pt">
ENSO episodes were assigned using NOAA's
[ONI Nino 3.4 ](https://origin.cpc.ncep.noaa.gov/products/analysis_monitoring/ensostuff/ONI_v5.php)
</span>

<br>

<span style="font-size:16pt">
For each of the figures below: <br>
**Black line: A given year's 18°C SST isotherm location** <br>
[**Gray line: The longterm 18°C SST isotherm (1985-2023) location**]{style="color:#6C757D"} <br>
The **black box is the spatial boundary (165°W to 140°W)** used to delineate the NE Pacific study area
</span>

<br>
<br>


![El Nino (Septembers Preceding an El Nino Epsisode)](images/plot_sept_ssta_yrs_with_sst_18C_pre_el_nino.png)

![La Nina (Septembers Preceding a La Nina Episode)](images/plot_sept_ssta_yrs_with_sst_18C_pre_la_nina.png)

![Neutral (Septembers Preceding a Neutral Episode)](images/plot_sept_ssta_yrs_with_sst_18C_pre_neutral.png)

![Marine Heatwave Septembers](images/plot_sept_ssta_yrs_with_sst_18C_mhw.png)